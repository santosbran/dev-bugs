<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html"  
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"> 
    <f:view> 
        <h:head> 
            <title>AEES - Sistema de ingenieria </title> 
            <h:outputScript library="styleAE" name="alerts/alertify.js"/>
            <h:outputScript library="styleAE" name="alerts/alertify.min.js"/>
            <h:outputStylesheet library="styleAE" name="alerts/alertify.core.css"/>
            <h:outputStylesheet library="styleAE" name="alerts/alertify.default.css"/> 
            <script type="text/javascript"> 
                $(document).ready(function (){
                var id =document.getElementById('inputFormemail:iddeow').value;
                document.getElementById("inputFormemail:idre").value = id;

                });
                
                function validarEmail() {
                var email = document.getElementById('inputFormemail:email').value;
                expr = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if ( !expr.test(email) )
                alert("Error: La dirección de correo " + email + " es incorrecta.");
            
                }
            </script> 
            <script>
                                function reOpenemail() {
                                    var opt = {
                                        autoOpen: false,
                                        modal: true

                                    };
                                    $("#inputModalemail").dialog(opt);
                                    $("#inputModalemail").dialog("open");

                                }
                            function crearModalemails(divId,tam,hei) {
                                $(divId).dialog({
                                    appendTo: "body",
                                    autoOpen: false,
                                    modal: true,
                                    width: tam,
                                    height: hei,
                                    resizable: false,
                                    position: {at: "center", of: window},
                                    show: {
                                        effect: "blind",
                                        duration: 400
                                    },
                                    hide: {
                                        effect: "blind",
                                        duration: 400
                                    }
                                });
                            }
                            
                             $(document).ready(function (){ 
                                crearModalemails('#inputModalemail', '400px',700);
                                crearModal('#alertEmail', '325px');
                            });
                            
                            function funalertEmail(idModal, id) {
                                $(idModal).dialog("open");
                                $('#removeEmail\\:idemail').val(id);
                                return false;
                            }
                            </script>
            
            <style>      /*Nuevos estilos MroHolding*/
                .tablehand>tbody>tr:hover{
                    background-color: gray !important;
                    color: white !important;
                }
                .dataTables_wrapper {
                    background: rgba(205,204,204,0.65) !important; 
                }
                table.dataTable thead {
                    background-color: gray !important;
                }           
                .container-fluid {   
                    padding: initial !important;
                }
                .dataTables_wrapper {
                    overflow-x: auto !important;
                }
            </style>
        </h:head> 
        <h:body> 
            
                        <!-- Page Heading --> 
                    <div class="container-fluid">
                                                
                        <div class="row menuMantenimientos">
                            <h:panelGroup id="slithermail">
                                <div id="slideDermail" class="menuemail posicionMenuManten" >

                                </div>
                            </h:panelGroup>
                            
                            <div class="c-hamburger c-hamburger--rot is-active"  id="c-hamburgermail">
                                <span>toggle menu</span>
                            </div>
                        </div>
                        
                    </div>
                        <h:panelGroup id="inputModalemail" style="display:none;" >
                            <h:form id="inputFormemail">
                                <h:inputHidden id="iddeow" value="#{emailEnBean.id}"/>    
                                <div class="modal-body anchoModalBodyEmailing flex md:flex-col lg:flex-col sm:flex-col lg:pl-28 lg:pr-20"> 
                                    <div class="row botomRow"> 
                                        <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 paddingIzq" >
                                            <h:outputLabel value="#{gen_msg['emails']}:" for="email" /> 
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-izq">
                                            <h:inputText id="email" value="#{emailEnBean.elemento.cemEmail}" class="form-control" 
                                                         validatorMessage="#{gen_msg['emails']} #{gen_msg['invfor']}"
                                                         required="true" requiredMessage="#{gen_msg['emails']} #{gen_msg['adjNecesario']}"
                                                         onkeyup="check(this,'warningemail','inputFormemail');" maxlength="60">
                                                <f:validateRegex pattern="(^$|^.*@.*\..*$)" />
                                            </h:inputText>
                                        </div>
                      
                                    </div> 
                                </div> 
                                <div class="alinearIzqmsgError">
                                    <h:outputLabel id="warningemail" value="  •  #{gen_msg['limitchar']}" class="msgError" style="display: none;"/>
                                    <h:inputHidden id="idre" value="#{emailEnBean.id}" />
                                    <h:messages for="email" class="msgError"/> 
                                </div>
                                <div class="divBotonesModales">
                                    <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-der">
                                        <h:commandButton class="btn btn-signin" value ="#{!emailEnBean.edit ? gen_msg['genAdd'] : gen_msg['genUpdate']}" action="#{emailEnBean.guardar()}"
                                                         disabled="#{empty contCheckBean.elemento.contCheckId}"> 
                                            <f:ajax execute="@form" render="onsuccessemail @form resultForm789 slithermail mailError refremeta"/> 
                                        </h:commandButton> 
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 alin-izq">
                                        <h:commandButton class="btn btn-signin" value ="#{gen_msg['discard']}" action="#{emailEnBean.limpiar()}" > 
                                            <f:ajax execute="@this" render="@form ondescaremail refremeta" /> 
                                        </h:commandButton> 
                                    </div>
                                </div>
                                
                            </h:form> 
                            
                            <h:panelGroup id="alertEmail" style="display:none;" pt:title="#{gen_msg['delete']}">
                                <h:form id="removeEmail">
                                    <h:inputText value="#{emailEnBean.idborrarEmail}" style="display: none;" id="idemail"><f:ajax event="change" render="@this refremeta" /></h:inputText>

                                    <h:panelGrid columns="1" columnClasses="cien-prc center-align" class="cien-prc">
                                        <h:outputLabel value="¿#{aees_msg['deleteitem']}?" class="margenlabelDelete"/> 
                                    </h:panelGrid>
                                    <div class="divBotonesModales">
                                        <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-der">
                                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['acept']}" action="#{emailEnBean.delete(emailEnBean.idborrarEmail)}" >
                                                <f:ajax execute="@form" render="ondeleteEmail ondeleteErrorEmail @form resultForm789 inputFormemail slithermail refremeta"/>
                                            </h:commandButton>
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 alin-izq">
                                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['cancel']}" action="#{emailEnBean.limpiar()}">
                                                <f:ajax execute="@this" render="ondescaremail @form refremeta" />
                                            </h:commandButton>
                                        </div>
                                    </div>
                                </h:form>
                            </h:panelGroup>
                             
                        </h:panelGroup> 
                        <h:form id="resultForm789" class="anchoTableMantenimientos"> 
                            <h:dataTable id="tblListado789" pt:name="tblListado789" class="anchoTableMantenimientos" value="#{emailEnBean.listado2}" var="item"> 
                                <h:column> 
                                    <f:facet name="header"> 
                                        <h:outputText value="#{gen_msg['code']}"/> 
                                    </f:facet> 
                                    <f:facet name="footer"> 
                                        <h:outputText value="#{gen_msg['code']}"/> 
                                    </f:facet> 
                                    <h:outputText value="#{item.contCheckEmailsId}"/> 
                                </h:column> 
                                <h:column> 
                                    <f:facet name="header"> 
                                        <h:outputText value="#{gen_msg['emails']}"/> 
                                    </f:facet> 
                                    <f:facet name="footer"> 
                                        <h:outputText value="#{gen_msg['emails']}"/> 
                                    </f:facet> 
                                    <h:outputText value="#{item.cemEmail}"/> 
                                </h:column> 

                                <h:column> 
                                    <h:commandButton class="btn-round-24 icon-edit-24" onclick="reOpenemail();"> 
                                        <f:setPropertyActionListener target="#{emailEnBean.elemento}" value="#{item}"/> 
                                        <f:setPropertyActionListener target="#{emailEnBean.edit}" value="#{true}"/> 
                                        <f:ajax execute="@this" render="scripcor inputFormemail refremeta" /> 
                                    </h:commandButton> 
                                </h:column> 
                                <h:column> 
                                    <h:commandButton class="btn-round-69 icon-remove-69" onclick="funalertEmail('#alertEmail', '${item.contCheckEmailsId}');"> 
                                        <f:ajax execute="@this" render="inputFormemail @form slithermail refremeta" /> 
                                    </h:commandButton> 
                                </h:column> 
                            </h:dataTable> 
                            <!--Aplicando el formato a la datatable, se hace de esta forma para que se aplique nuevamente tras el rerenderizado del form--> 
                            <h:outputScript>formatTable('table[name=tblListado789]','${swtLanguage.language}','#inputModalemail','.menuemail');</h:outputScript> 
                        </h:form> 
                        <h:panelGroup id="onsuccessemail"> 
                            <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}"> 
                                $("#inputModalemail").dialog("close");
                                $("#alertEmail").dialog("close");
                                alertify.success("#{aees_msg['exito']}"); 
                            </h:outputScript> 
                        </h:panelGroup>
                        <h:panelGroup id="ondescaremail">
                            <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                                $("#inputModalemail").dialog("close");
                                $("#alertEmail").dialog("close");
                                alertify.custom = alertify.extend("custom");
                                alertify.custom("#{aees_msg['descardoperation']}");
                            </h:outputScript>
                        </h:panelGroup>
                        <h:panelGroup id="ondeleteEmail">
                            <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                                $("#inputModalemail").dialog("close");
                                $("#alertEmail").dialog("close");
                                alertify.log("#{aees_msg['removeitem']}");
                            </h:outputScript>
                        </h:panelGroup>
                        <h:panelGroup id="ondeleteErrorEmail">
                            <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed and emailEnBean.menscons eq 1}">
                                $("#inputModalemail").dialog("close");
                                $("#alertEmail").dialog("close");
                                alertify.log("#{gen_msg['inventory.menssage.deleteError']}");
                            </h:outputScript>
                        </h:panelGroup>
                        <h:panelGroup id="mailError">
                            <h:outputScript rendered="#{facesContext.postback and facesContext.validationFailed and !emailEnBean.mval}">
                                alertify.log("#{gen_msg['emails']} #{gen_msg['invfor']}");
                            </h:outputScript>
                        </h:panelGroup>
        </h:body> 
    </f:view> 
</html> 
