<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <f:view locale="#{swtLanguage.locale}">
        <h:head>
            <title></title>
            <script>
                $(document).ready(function (){
                crearModal('#inputModalMeasure', '675px');
                crearModal('#alertStaMeasure', '325px');
                });
           
                function funalertMeasure(idModal, id) {
                    $(idModal).dialog("open");
                    $('#removeMeasure\\:idengId').val(id);
                    return false;
                }
                
                function ValidarCaracteresEsp(e) {
                    var tecla = (document.all) ? e.keyCode : e.which;

                    //Tecla de retroceso para borrar, siempre la permite
                    if (tecla == 8) {
                        return true;
                    }

                    // Patron de entrada, en este caso solo acepta numeros y letras
                    patron = /[A-Za-z0-9]/;
                    tecla_final = String.fromCharCode(tecla);
                    return patron.test(tecla_final);
                }
                
                $(document).on('keyup','input',function() {  
                    /* Obtengo el valor contenido dentro del input */
                    var value = $(this).val();

                    if (value.trim() == ""){
                        /* Elimino todos los espacios en blanco que tenga la cadena delante y detrás */
                        var value_without_space = $.trim(value);

                        /* Cambio el valor contenido por el valor sin espacios */
                        $(this).val(value_without_space);
                        } 
                });
            </script>
            <style>
         
          .ui-widget-content {   
                background: #fff !important;

            }
            
            .menuMeasure{
                position: absolute;
                top: 1%;
                float: right;
                z-index: 999;
            }
            </style>
        </h:head>
        <h:body>
            <div>
            <!-- Page Heading -->
            <div class="row menuMantenimientos">
                <h:panelGroup id="sliMeasure">
                    <div id="slideDer2" class="menuMeasure posicionMenuManten" >
                    </div>
                </h:panelGroup>
                <div class="c-hamburger c-hamburger--rot is-active"  id="c-hamburgerClass" >
                    <span>toggle menu</span>
                </div>
            </div>

            <h:panelGroup id="inputModalMeasure" style="display:none;" pt:title="Measure">
                <h:form id="inputFormMeasure">
                    <div class="modal-body anchoModalBodyDamageDim flex md:flex-col lg:flex-col sm:flex-col lg:pl-20 lg:pr-40"> 
                        <div class="row botomRow"> 
                            <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 paddingIzq">
                                <h:outputLabel value="Measure descripcion" for="cbMeasure" /> 
                                <h:outputText value="  *  " class="msgError"/>
                            </div>
                            <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-izq">
                                <h:inputText id="cbMeasure" value="#{engMeasureBean.elemento.engMeasure}" class="form-control" 
                                                required="true" requiredMessage="•  #{gen_msg['adjNecesario']}"
                                                onkeypress="return ValidarCaracteresEsp(event)">
                               </h:inputText>
                            </div>
                        </div>
                       
                    </div>
                    <div class="alinearIzqmsgError">
                        <h:outputText id="reqexistMeasure" class="msgError"  value="  •  #{gen_msg['datoexiste']}" style="display: #{engMeasureBean.encontrarRepetido ? 'block':'none'}"/>                            
                        <h:message for="cbMeasure" class="msgError" style="display: table-row;" />                      
                    </div>
                    <div class="divBotonesModales">
                        <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-der">
                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['genAdd']}" action="#{engMeasureBean.agregar()}" >
                                <f:ajax execute="@form" render="@form successHMeasure  resultFormMeasure sliMeasure sliMeasure refremeta"/>
                            </h:commandButton>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 alin-izq">

                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['close']}" action="#{engMeasureBean.limpiar()}" >
                                <f:ajax execute="@this"  render="onsuccessMeasure @form resultFormMeasure sliMeasure refremeta" />
                            </h:commandButton>
                        </div>
                    </div>
                </h:form>
                
            </h:panelGroup>
            <h:panelGroup id="alertStaMeasure" style="display:none;" pt:title="#{gen_msg['delete']}">
                <h:form id="removeMeasure">
                    <h:inputText value="#{engMeasureBean.elemento.engId}" style="display: none;" id="idengId">
                        <f:ajax event="change" render="@this refremeta" />
                    </h:inputText>

                    <h:panelGrid columns="1" columnClasses="cien-prc center-align" class="cien-prc">
                        <h:outputLabel value="¿#{aees_msg['deleteitem']}?" class="margenlabelDelete"/> 
                    </h:panelGrid>

                    <div class="divBotonesModales">
                        <div class="col-md-6 col-sm-6 col-lg-6 col-xs-6 alin-der">
                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['acept']}" action="#{engMeasureBean.deleteMeasure()}" >
                                <f:ajax execute="@form" render="ondeleteMeasure beanerrMeasure @form sliMeasure resultFormMeasure inputFormMeasure sliMeasure refremeta pCount onErrorMeasure"/>
                            </h:commandButton>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-6 col-lg-6 alin-izq">
                            <h:commandButton class="btn btn-signin" value ="#{gen_msg['cancel']}" action="#{damdimbean.limpiar()}">
                                <f:ajax execute="@this" render="onsuccessMeasure @form resultFormMeasure sliMeasure refremeta" />
                            </h:commandButton>
                        </div>
                    </div>
                </h:form>
            </h:panelGroup>
            <!--Se renderiza si no hay errores de forma que se cierre la modal al llamar descartar o guardar-->
            <h:panelGroup id="onsuccessMeasure">
                <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                    $("#inputModalMeasure").dialog("close");
                    $("#alertStaMeasure").dialog("close");
                    alertify.custom = alertify.extend("custom");
                    alertify.custom("#{aees_msg['descardoperation']}");
                </h:outputScript>
            </h:panelGroup>
            <h:panelGroup id="successHMeasure">
                <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                    $("#inputModalMeasure").dialog("close");
                    $("#alertStaMeasure").dialog("close");
                    alertify.success("#{aees_msg['exito']}");
                </h:outputScript>
            </h:panelGroup>
            <h:panelGroup id="ondeleteMeasure">
                <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                    $("#inputModalMeasure").dialog("close");
                    $("#alertStaMeasure").dialog("close");
                    alertify.log("#{aees_msg['removeitem']}");
                </h:outputScript>
            </h:panelGroup>
            <h:panelGroup id="onErrorMeasure">
                <h:outputScript rendered="#{facesContext.postback and facesContext.validationFailed and engMeasureBean.pCount gt 0}">
                    $("#inputModalMeasure").dialog("close");
                    $("#alertStaMeasure").dialog("close");
                    alertify.error("#{aees_msg['notdelete']}");
                </h:outputScript>
            </h:panelGroup>

            <h:form id="resultFormMeasure" class="anchoTableMantenimientos">
                <h:dataTable id="tblListadoMeasure" class="table table-striped dt-responsive anchoTableMantenimientos" pt:name="tblListadoMeasure" 
                             value="#{engMeasureBean.listado}" var="item">
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="ID"/>
                        </f:facet>
                        <f:facet name="footer" >
                            <h:outputText value="ID"/>
                        </f:facet>
                        <h:outputText value="#{item.engId}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="Measure"/>
                        </f:facet>
                        <f:facet name="footer" >
                            <h:outputText value="Measure"/>
                        </f:facet>
                        <h:outputText value="#{item.engMeasure}"/>
                    </h:column>  
                    <h:column>
                        <h:commandButton class="btn-round-69 icon-remove-69" onclick="funalertMeasure('#alertStaMeasure', '${item.engId}');">
                            <f:ajax execute="@this" render="@this refremeta" />
                        </h:commandButton>
                    </h:column>
                    
                </h:dataTable>
                <!--Aplicando el formato a la datatable, se hace de esta forma para que se aplique nuevamente tras el rerenderizado del form-->
                <h:outputScript>                    
                    formatTable('table[name=tblListadoMeasure]','${swtLanguage.language}','#inputModalMeasure','.menuMeasure');
                </h:outputScript>

            </h:form>
            </div>
        </h:body>
    </f:view>
</html>
