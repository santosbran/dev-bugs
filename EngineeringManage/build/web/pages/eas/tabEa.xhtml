<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <f:view>
        <h:head>
            <title> </title>
                
            <style>
            .menuFormEA {
                position: absolute;
                top: 1%;
                float: right;
                z-index: 999; 
            }
               .menuTabListEA {
                    position: absolute;
                    top: 1%;
                    float: right;
                    z-index: 999; 
                }
                .divBotonesEA {
                    width: 50%;
                    padding-bottom: 11%;    
                    margin-left: 36%;
                    margin-right: 36%;
                    margin-top: 7%;
                }
                .divBotonesCoverEA{
                    margin-left: 7%;
                    width: 89.2%;
                    background: white;
                    
                }
                .divBotonesCoverEA > .col-lg-2{
                    position: relative;
                    left: 17%;
                }
                
                
                @media (min-width: 2401px) and (max-width: 2600px) {
                  
                    .divBotonesEA > .col-md-2{
                        padding: 0 45px 0 0;
                    }
                 }
                @media (min-width: 2130px) and (max-width: 2400px) {
                   
                    .divBotonesEA > .col-md-2{
                        padding: 0 45px 0 0;
                    }
                 }
                 
                 @media (min-width: 1700px) and (max-width: 1900px) {
                     .divBotonesEA {
                        margin-top: 6%!important;
                    }
                 }
                 @media (min-width: 1500px) and (max-width: 1799px) {
                     .divBotonesEA {
                        margin-top: 3%!important;
                    }
                 }                
            </style>
            
        </h:head>
        <h:body>            
            <script>
                function reGresarEA(){
                    $("#ea").hide();
                    $("#esr").show();
                } 
                function selectForEA(idEA){
                    $("#formEAButtom\\:idEAForm").val(idEA);
                    $("#formEAButtom\\:buttomEAForm").trigger("click");                    
                }
                function backTabEANew(){
                     var tiposol=document.getElementById("inputForm68:lblTail").innerHTML;
                console.log("retornado de la EA hacia el formulario de "+tiposol);
                    if(tiposol==="TOOL:"){
                        
                         $("#eaForm").hide(); 
                    $("#engineerTools").show();
                    $("#mainETR").show();    
                    $("#supervisor").show();
                  mostrarbtn();
                        
                    }else{
                    $("#eaForm").hide(); 
                    $("#engineer").show();
                    $("#main").show();    
                    $("#supervisor").show();
                    window.switchSpaceNav();
                    mostrarbtn();
                }
                }
            </script>
            <h:panelGroup  >
                
                <!-- Panel central de la EA-->
                <h:form id="formEAButtom" style="display: none">
                    <h:inputText id="idEAForm" value="#{tabEsrEaEoBean.idEAForm}" style="display: none;">
                        <f:ajax execute="@this" event="change" render="@this refremeta"/>
                    </h:inputText>
                    <h:commandButton id="buttomEAForm" style="display: none;" value ="EA" action="#{tabEsrEaEoBean.actEA(tabEsrEaEoBean.idEAForm)}">
                        <f:ajax execute="@form" render="resultabtodosComp @form resultForm resultFormEAList resultForm69 resultForm inputForm68 resultabEa autocom1 refremeta"/>
                    </h:commandButton>
                </h:form>
                <div id="panelEAuto" style="overflow-y: auto; overflow-x: hidden; background: white;" class="dashboard-content-h pb-16">
                <h:form id="inputForm68" style="background: white; width: 100%;">
                    <h:panelGroup id="autocom1">
                        <script type="text/javascript">
                            $(function () {
                                $('#inputForm68\\:feRev').datepicker({autoclose: true, language: '#{swtLanguage.language}'});
                            });
                        </script>
                    </h:panelGroup>    
                    <br/>                   
                   <div class="flex justify-center flex-wrap w-full h-full mx-auto" style="max-width: 1000px;">
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['reqMess']}:" for="reqMessageid" />
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="reqMessageid"  value="#{engAutorizationBean.elemento.reqMessageid}" class="form-control" disabled="true" />
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="No EA:" for="noEAForm" />
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="noEAForm"  value="#{engAutorizationBean.elemento.eagAta}-#{engAutorizationBean.elemento.eagCorrelative}-#{engAutorizationBean.elemento.yearEA}" class="form-control" disabled="true" style="#{!engAutorizationBean.edit ? 'display:none':'display:block'};" /> 
                                <h:inputText id="noEAForm2"  value="" class="form-control" disabled="true" style="#{!engAutorizationBean.edit ? 'display:block':'display:none'};" />
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['tailPlane']}:" for="tail" />
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="tail" value="#{engAutorizationBean.elemento.eagTail}" class="form-control" disabled="true"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['model']}:" for="model"/>
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="model"  value="#{engAutorizationBean.elemento.eagModel}" autocomplete="off" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['engiManag']}:" for="eoOwner"/>
                            </div>
                            <div class="form-esr-control">
                                <h:selectOneMenu value="#{engAutorizationBean.elemento.aegIngComm}" id="eoOwner" class="form-control">
                                    <f:selectItem itemLabel="....." itemValue="#{null}"/>
                                    <f:selectItems value="#{coreUsers.listaIng}" var="optionIng" itemLabel="#{optionIng[1]}" itemValue="#{optionIng[0]}"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="" for="ATA">
                                    #{gen_msg['ATA']}:<h:outputText value="  *  " class="msgError"/>
                                </h:outputLabel>                                
                            </div>
                            <div class="form-esr-control">
                                <h:selectOneMenu id="ATA"  value="#{engAutorizationBean.elemento.eagAta}" class="form-control"  
                                    required="true" requiredMessage="#{gen_msg['ATA']} #{gen_msg['adjNecesario']}">
                                   <f:selectItem itemLabel="....." itemValue="#{null}"/>
                                   <f:selectItems   value="#{contAtas.listado}" var="option" itemLabel="#{option.ataNumata}-#{option.ataDescription}" itemValue="#{option.ataNumata}"/>
                                   <f:ajax execute="@this" event="change" render="mesATA refremeta"/> 
                                </h:selectOneMenu>
                                <h:messages id="mesATA" for="ATA" class="msgError"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['status']}:" for="status" />       
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="status"  value="#{engAutorizationBean.elemento.estEstatus.eaeEstName}" class="form-control" disabled="true" />
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['dateRev']}:" />     
                            </div>
                            <div class="form-esr-control">
                                <h:inputText value="#{engAutorizationBean.elemento.eagDateEmi}" id="feRev" autocomplete="off" class="form-control" 
                                    pt:placeholder="#{gen_msg['frmtDateConv']}" maxlength="10" disabled="true"
                                    converterMessage="#{gen_msg['finaccDateFormatMessage']}">
                                   <f:convertDateTime pattern="#{gen_msg['frmtDateConv']}" timeZone="GMT-6"/>
                                   <f:ajax execute="@this" event="change" render="eadaterev refremeta"/>
                               </h:inputText>
                               <h:messages id="eadaterev" for="feRev" class="msgError"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['year']}:" for="year" /> 
                            </div>
                            <div class="form-esr-control">
                                <h:inputText id="year" value="#{engAutorizationBean.elemento.eagYear}" class="form-control" maxlength="4" disabled="true"
                                    onkeypress="return NumCheck(event, this)" autocomplete="off"
                                    validatorMessage="#{gen_msg['invfor']} #{gen_msg['foreAno']}">
                                   <f:validateRegex pattern="[1-9][0-9][0-9][0-9]"/>
                                   <f:ajax execute="@this" event="change" render="eayear refremeta"/>
                               </h:inputText>
                               <h:messages id="eayear" for="year" class="msgError"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['compoPN']}:" for="compoPN"/>                        
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText id="compoPN" value="#{engAutorizationBean.elemento.eagCmpPn}" autocomplete="off" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['compoSN']}:" for="compoSN"/>
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText id="compoSN" value="#{engAutorizationBean.elemento.eagCmpSn}" autocomplete="off" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['serialNumber']}:" for="sernumber" />
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText id="sernumber"  value="#{engAutorizationBean.elemento.eagSn}" autocomplete="off" class="form-control" />
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{aees_msg['dateRev']} Cover:" />
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText value="#{engAutorizationBean.elemento.aegDateRev}" id="feRevcover" class="form-control" 
                                    pt:placeholder="#{gen_msg['frmtDateConv']}" maxlength="10" autocomplete="off"
                                    converterMessage="#{gen_msg['finaccDateFormatMessage']}" disabled="true">
                                   <f:convertDateTime pattern="#{gen_msg['frmtDateConv']}" timeZone="GMT-6"/>
                                   <f:ajax execute="@this" event="change" render="eadaterevcover refremeta"/>
                               </h:inputText>
                               <h:messages id="eadaterevcover" for="feRevcover" class="msgError"/>
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['revnum']} Cover:" for="noCover" />
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText id="noCover"  value="#{engAutorizationBean.elemento.aegRevNum}" disabled="true" class="form-control" />
                            </div>
                        </div>
                        <div class="form-esr-col flex flex-col md:flex-row w-full md:w-1/2 p-2">
                            <div class="form-esr-label">
                                <h:outputLabel value="#{gen_msg['revnum']} #{gen_msg['parts']}" for="noPart" style="display: none;" />
                            </div>
                            <div class="form-esr-control">              
                                <h:inputText id="noPart"  value="#{engAutorizationBean.elemento.aegNumPart}" disabled="true" class="form-control" style="display: none;"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-esr-table flex flex-col md:flex-row justify-center w-full h-full pb-8 px-2 pt-2 mx-auto" style="max-width: 1000px;">
                        <div class="form-esr-label">
                            <h:outputLabel value="#{gen_msg['title']}:" for="eaTitle"/>
                            <h:outputText value="  *  " class="msgError"/>
                        </div>
                        <div class="form-esr-control">
                            <h:inputTextarea id="eaTitle" value="#{engAutorizationBean.elemento.eagTitle}" class="form-control" style="resize: none;"
                                             required="true" requiredMessage="#{gen_msg['title']} #{gen_msg['adjNecesario']}" >
                                <f:ajax execute="@this" event="blur" render="mesTitle refremeta"/>
                            </h:inputTextarea>
                            <h:messages id="mesTitle" for="eaTitle" class="msgError"/>
                        </div>
                    </div>
                   <!-- <h:messages class="msgError"/> -->
                   <h:panelGrid columns="2" class="tableeo" columnClasses="ten-prc right-align, ten-prc right-align" style="margin: 0 auto; width: 50%;">
                       <h:column>
                           <h:commandButton class="btn btn-signin" value ="#{!engAutorizationBean.edit ? gen_msg['genAdd'] : gen_msg['genUpdate']}" action="#{tabEsrEaEoBean.guardarEA()}">
                                <f:ajax execute="@form" render="onsuccess68 onErrorSuccess68 resultabtodosComp @form resultForm resultForm69 resultFormEAList resultForm inputForm68 resultabEa autocom1 refremeta"/>
                            </h:commandButton>
                       </h:column>
                       <h:column>
                           <h:commandButton class="btn btn-signin" value ="#{gen_msg['discard']}" action="#{tabEsrEaEoBean.limpiar2(1)}" >
                                <f:ajax execute="@this" render="@form inputForm68 autocom1 resultFormEAList ondescarEA refremeta"/>
                            </h:commandButton>
                       </h:column>                       
                   </h:panelGrid>
                   
                   <div class="flex mx-auto justify-center">
                        <h:commandButton class="w-40 bg-aes-blue text-white text-center py-2 m-1 " value ="Cover"  style="margin-top: 0;#{!engAutorizationBean.edit ? 'display:none':'display:block'};"  action="#{engAutorizationBean.reportecover()}" >
                        </h:commandButton>
                        <h:commandButton class="w-40 bg-aes-blue text-white text-center py-2 m-1 " value ="#{gen_msg['parts']}" style="margin-top: 0;#{!engAutorizationBean.edit ? 'display:none':'display:block'};"  action="#{engAutorizationBean.reporteParts()}">
                        </h:commandButton>
                        <h:commandButton id="sacarea" class="w-40 bg-aes-blue text-white text-center py-2 m-1 " value ="#{gen_msg['document']}" style="margin-top: 0;#{!engAutorizationBean.edit ? 'display:none':'display:block'};" onclick="$('#eaForm').hide(); $('#docea').show();">
                            <f:ajax execute="@form" listener="#{tabEsrEaEoBean.ea(engAutorizationBean.elemento.eagId)}" render="resultForm71 resultForm71:tblListado71 inputFormDocEA refremeta"/>
                        </h:commandButton>
                        <h:commandButton id="cancelea" class="w-40 bg-aes-blue text-white text-center py-2 m-1 " value ="#{gen_msg['cancel']} EA" disabled="#{engAutorizationBean.elemento.estEstatus ne 'P'}"
                                         style="margin-top: 0;#{!engAutorizationBean.edit ? 'display:none':'display:block'};" onclick="$('#alertCancelEA').dialog('open');">
                            <f:ajax execute="@this" render="@this refremeta"/>
                        </h:commandButton>                           
                       
                   </div>
                    <!-- aplicando formato a los DTP, se ejecuta de esta forma para que cuando se rerenderize el elemento se vuelva a aplicar el formato-->
                    <script>
                        $('#inputForm68\\:feRev').datepicker({autoclose: true, language: '#{swtLanguage.language}'});
                        $('#inputForm68\\:feRevcover').datepicker({autoclose: true, language: '#{swtLanguage.language}'});
                    </script>
                    
                </h:form>
                <h:form id="resultFormEAList">
                    <h:dataTable id="tblListadoFormEA" class="table table-striped dt-responsive anchoTableMantenimientos" 
                    columnClasses=",ten-prc,twenty-prc,twenty-prc,ten-prc,ten-prc" pt:name="tblListadoFormEA" value="#{tabEsrEaEoBean.listAll}" var="item1">
                        <ui:param name="taskeo" value="#{item1[0]}##{item1[1].eoIdord}-#{item1[1].eoSubject}"/>                                                                                                        
                        <ui:param name="taskea" value="#{item1[0]}##{item1[1].eagId}-#{item1[1].eagTitle}"/>
                        <ui:param name="cuseo" value="#{item1[1].eoCustomer}-#{item1[1].eoTail}"/>
                        <ui:param name="statusEA" value="#{item1[1].estEstatus.eaeEstName}"/>
                        <ui:param name="statusEAID" value="#{item1[1].estEstatus.eaeId}"/>
                        <ui:param name="userEA" value="#{item1[1].userEA}"/>
                        <ui:param name="ingenieroComn" value="#{item1[1].aegIngComm}"/>
                        <ui:param name="idEA" value="#{item1[1].eagId}"/>
                        <ui:param name="correlativo" value="#{item1[1].eagCorrelative}"/>
                        <ui:param name="eagAta" value="#{item1[1].eagId eq null ? '':item1[1].eagAta}"/>
                        <ui:param name="dateEA" value="#{item1[1].yearEA}"/>
                        <ui:param name="titleEA" value="#{item1[1].eagTitle}"/>
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="#{gen_msg['id']}"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="#{gen_msg['id']}"/>
                            </f:facet>
                            <h:outputText  value="#{idEA}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="No EA"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="No EA"/>
                            </f:facet>
                            <h:outputText  value="#{eagAta}-#{correlativo}-#{dateEA}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="#{gen_msg['title']}"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="#{gen_msg['title']}"/>
                            </f:facet>
                            <h:outputText  value="#{titleEA}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="#{aees_msg['engiManag']}"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="#{aees_msg['engiManag']}"/>
                            </f:facet>
                            <h:outputText  value="#{userEA}"/>
                        </h:column> 
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="#{gen_msg['status']}"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="#{gen_msg['status']}"/>
                            </f:facet>
                            <h:outputText  value="#{statusEA}"/>
                        </h:column> 
                        <h:column>
                            <f:facet name="header">
                                <h:outputText value="#{gen_msg['document']}"/>
                            </f:facet>
                            <f:facet name="footer" >
                                <h:outputText value="#{gen_msg['document']}"/>
                            </f:facet>
                             <h:commandButton id="sacarea" class="w-40 bg-aes-blue text-white text-center py-2 m-1 mx-auto" value ="#{gen_msg['document']}" onclick=" $('#eaForm').hide(); $('#docea').show();" style="#{idEA eq null ? 'display:none;':'display:block;'}">
                                <f:ajax execute="@form" listener="#{tabEsrEaEoBean.ea(idEA)}" render="resultForm71 resultForm71:tblListado71 inputFormDocEA refremeta"/>
                            </h:commandButton>
                        </h:column> 
                    </h:dataTable>
                    <!--Aplicando el formato a la datatable, se hace de esta forma para que se aplique nuevamente tras el rerenderizado del form-->
                    <h:outputScript id="scroptFormEA">
                        splitFormEA();                    
                        function splitFormEA(){ 
                            $("#resultFormEAList\\:tblListadoFormEA tbody tr").each(function (index) {
                            var selTrac=$(this);
                            var text1=$(this).children("td")[0].textContent;
                            selTrac.attr('onclick', 'selectForEA('+text1+');');
                            selTrac.attr('id', 'idEA'+index);
                            });
                        }                        
                        formatTableEA('table[name=tblListadoFormEA]','${swtLanguage.language}','#ghhghf','.menuFormEA');
                        function formatTableEA(tableId, language, insertModal,menu){
                            //agrega los input fields para los filtros
                            $(tableId + " tfoot td").each( function () {
                                var title = $(this).text();
                                if (!(!title || title.trim() == "")){
                                    $(this).html( '<input type="text" placeholder="'+title+'" style="width: 100%;"/>' );
                                }
                            } );
                            //crea la tabla con sus propiedades
                            var table = $(tableId).DataTable({
                                dom: 'lBfrtip',
                                sPaginationType: "full_numbers",
                                lengthMenu: [[25, 50, -1], [25, 50, "All"]],
                                columnDefs:[                                    
                                    {
                                        targets:[0],
                                        visible:false,
                                        searchable:true
                                    }
                                ],
                                buttons: [                                 
                                 {extend:'copy', text:'',container: menu, titleAttr: 'Copy'},
                                 {extend:'print', text:'',container: menu,titleAttr: 'Print'},
                                 {extend:'pdf', text:'',container: menu,titleAttr: 'Export to pdf'},
                                 {extend:'excel', text:'',container: menu,titleAttr: 'Export to Excel'}
                                 ]
                            });
                            //agrega la función de filtrado a los input generados anteriormente
                            table.columns().every( function () {
                                var that = this;
                                $( 'input', this.footer() ).on( 'keyup change', function () {
                                    if ( that.search() !== this.value ) {
                                        that
                                            .search( this.value )
                                            .draw();
                                    }
                                } );
                            } );
                            //cambia de color al registro seleccionado
                            $(tableId + ' tbody').on('click','tr',function(){
                                $(tableId + ' tbody tr').removeClass('selected');
                                $(this).toggleClass('selected');
                            });
                        };
                    </h:outputScript>
                </h:form>
                </div>
                <!--Se renderiza si no hay errores de forma que se cierre la modal al llamar descartar o guardar-->
                <h:panelGroup id="onsuccess68">
                    <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">
                        alertify.success("#{aees_msg['exito']}");
                    </h:outputScript>
                </h:panelGroup>
                <h:panelGroup id="ondescarEA">
                        <h:outputScript rendered="#{facesContext.postback and not facesContext.validationFailed}">                            
                            alertify.custom = alertify.extend("custom");
                            alertify.custom("#{aees_msg['descardoperation']}");
                        </h:outputScript>
                    </h:panelGroup>
                <h:panelGroup id="onErrorSuccess68">
                    <h:outputScript rendered="#{facesContext.postback and facesContext.validationFailed}">                        
                        alertify.error("#{gen_msg['expdatemala']}");
                    </h:outputScript>
                </h:panelGroup>
            </h:panelGroup> 
        </h:body>
    </f:view>
</html>
